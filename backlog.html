<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>IoTGuard â€” Backlog</title>
  <meta name="description" content="IoTGuard product backlog and sprints." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css?v=14" />

  <style>
    /* ---------- Glassy navbar + indicator (safe inline so it works on this page) ---------- */
    header.nav{
      background: rgba(8,12,18,.65);
      backdrop-filter: saturate(140%) blur(12px);
      border-bottom: 1px solid rgba(255,255,255,.1);
      position: relative;
      z-index: 2;
    }
    header.nav::after{
      content:""; position:absolute; left:0; right:0; bottom:0; height:2px;
      background: linear-gradient(90deg,#60a5fa,#a78bfa); opacity:.45;
    }
    .menu{ position:relative }
    .menu .indicator{
      position:absolute; left:10px; bottom:6px; height:2px; width:0;
      background: linear-gradient(90deg,#60a5fa,#a78bfa);
      border-radius:2px; opacity:.9; pointer-events:none;
      transition: left .28s ease, width .28s ease, opacity .28s ease;
    }
    .menu a::after{ content:none !important; }
    .menu a.is-active{ color:#dbeafe; text-shadow:0 0 10px rgba(96,165,250,.25) }

    /* ---------- Hero ---------- */
    .page-hero{ position:relative; background: linear-gradient(180deg,#070a10,#0b1220 30%,#0a0f18 70%) }
    .page-hero::before{
      content:""; position:absolute; inset:0;
      background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' stroke='rgba(255,255,255,0.05)' stroke-width='1'%3E%3Cpath d='M0 50h400M0 100h400M0 150h400M0 200h400M0 250h400M0 300h400M0 350h400M50 0v400M100 0v400M150 0v400M200 0v400M250 0v400M300 0v400M350 0v400'/%3E%3C/g%3E%3C/svg%3E");
      background-size:360px 360px; opacity:.22; mix-blend-mode:screen; pointer-events:none;
      animation: grid-pan 40s linear infinite;
    }
    @keyframes grid-pan{ from{transform:translate3d(0,0,0)} to{transform:translate3d(-360px,-220px,0)} }
    .page-hero h1{
      font-size: clamp(36px, 5.8vw, 62px);
      font-weight: 800; letter-spacing:.2px;
      background: linear-gradient(90deg,#c7d2fe,#a5b4fc 40%,#a78bfa);
      -webkit-background-clip:text; background-clip:text; color:transparent;
      margin-bottom: 6px;
    }
    /* Ensure hero never flickers */
    header.nav, .page-hero, .section, .footer{ position:relative; z-index:1; background:transparent }
    .page-hero .reveal{ opacity:1 !important; transform:none !important }

    /* ---------- Backlog toolbar + form (stable layout) ---------- */
    .toolbar{
      display:grid; grid-template-columns: 1fr auto;
      gap:12px; align-items:center; margin:14px 0 10px;
    }
    .toolbar .actions{ display:flex; gap:10px; align-items:center }
    .input-lite{ background:#0d1520; color:var(--text); border:1px solid var(--line); border-radius:10px; padding:10px 12px; width:100% }

    .form-row{
      display:grid; gap:12px; align-items:center;
      grid-template-columns: 1.6fr 1fr .8fr .6fr auto;
    }
    @media (max-width: 980px){ .form-row{ grid-template-columns: 1fr 1fr } }
    @media (max-width: 560px){
      .toolbar{ grid-template-columns: 1fr }
      .toolbar .actions{ justify-content:flex-start }
      .form-row{ grid-template-columns: 1fr }
    }

    /* ---------- Kanban cards ---------- */
    .kanban{display:grid; grid-template-columns:repeat(3,1fr); gap:18px; margin-top:14px}
    @media(max-width:960px){.kanban{grid-template-columns:1fr}}
    .col{background:linear-gradient(180deg,var(--panel),var(--panel-alt)); border:1px solid rgba(255,255,255,.08); border-radius:16px; padding:12px; min-height:240px; display:flex; flex-direction:column}
    .col h3{display:flex;justify-content:space-between;align-items:center;margin:0 0 8px}
    .drop{flex:1; display:grid; gap:10px; min-height:160px}
    .drop.dragover{outline:2px dashed rgba(96,165,250,.5); outline-offset:6px; border-radius:12px}
    .cardx{background:rgba(255,255,255,.02); border:1px solid rgba(255,255,255,.10); border-radius:12px; padding:12px; cursor:grab}
    .cardx:hover{transform:translateY(-2px); border-color:rgba(96,165,250,.35)}
    .title{font-weight:700}
    .meta{font-size:.9rem;color:#cbd5e1;display:flex;gap:8px;flex-wrap:wrap}
    .pill{padding:2px 8px;border-radius:999px;font-weight:700;font-size:.8rem}
    .p-high{background:rgba(239,68,68,.15);color:#fecaca}
    .p-med{background:rgba(245,158,11,.15);color:#fde68a}
    .p-low{background:rgba(16,185,129,.15);color:#bbf7d0}

    table{width:100%;border-collapse:collapse;margin-top:18px}
    th,td{padding:10px;border-bottom:1px solid rgba(255,255,255,.08);text-align:left}
    th{color:#cbd5e1;font-weight:700}
  </style>
</head>
<body>
  <!-- Ambient animated background -->
  <div class="ambient-bg" aria-hidden="true"></div>

  <!-- Nav -->
  <header class="nav">
    <div class="container nav-inner">
      <a class="brand" href="index.html">IoTGuard</a>
      <nav class="menu" id="mainMenu">
        <a href="index.html">Home</a>
        <a href="features.html">Features</a>
        <a href="about.html">About</a>
        <a href="documents.html">Documents</a>
        <a href="references.html">References</a>
        <a href="backlog.html">Backlog</a>
        <span class="indicator" aria-hidden="true"></span>
      </nav>
    </div>
  </header>

  <!-- Hero + controls -->
  <section class="page-hero">
    <div class="container">
      <h1 class="reveal">Project Backlog</h1>
      <p class="subtitle reveal delay-1">All tasks to build IoTGuard â€” nothing started yet.</p>

      <div class="toolbar">
        <input id="search" class="input-lite" type="search" placeholder="Filter tasksâ€¦" />
        <div class="actions">
          <button id="exportCsv" class="btn tiny pill">Export CSV</button>
          <button id="resetBoard" class="btn tiny pill">Reset Board</button>
        </div>
      </div>

      <form id="newItem" class="form-row" autocomplete="off">
        <input type="text" id="title" class="input-lite" placeholder="Task titleâ€¦" required />
        <select id="assignee" class="input-lite">
          <option value="Ahmad" selected>Ahmad</option>
          <option value="Ates">Ates</option>
          <option value="Esra">Esra</option>
          <option value="Team">Team</option>
        </select>
        <select id="priority" class="input-lite">
          <option>High</option><option selected>Medium</option><option>Low</option>
        </select>
        <input type="number" id="points" class="input-lite" placeholder="Story points" min="1" max="21" />
        <button class="btn pill" type="submit">Add Task</button>
      </form>
    </div>
  </section>

  <!-- Kanban -->
  <section class="section">
    <div class="container">
      <div class="kanban">
        <div class="col"><h3>To-Do <span id="cTodo">0</span></h3><div class="drop" id="todo" data-col="todo"></div></div>
        <div class="col"><h3>In Progress <span id="cDoing">0</span></h3><div class="drop" id="doing" data-col="doing"></div></div>
        <div class="col"><h3>Done <span id="cDone">0</span></h3><div class="drop" id="done" data-col="done"></div></div>
      </div>

      <table id="tbl">
        <thead>
          <tr><th>ID</th><th>Title</th><th>Priority</th><th>Status</th><th>Assignee</th><th>Points</th></tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>
  </section>

  <!-- Footer -->
  <footer class="footer">
    <div class="container foot-grid">
      <div>Â© <span id="year"></span> IoTGuard</div>
      <div class="foot-links">
        <a href="index.html">Home</a>
        <a href="features.html">Features</a>
        <a href="about.html">About</a>
        <a href="documents.html">Documents</a>
        <a href="references.html">References</a>
        <a href="backlog.html">Backlog</a>
      </div>
    </div>
  </footer>

  <!-- Scripts at the end (no flicker, DOM exists) -->
  <script>
    // Year
    document.getElementById('year').textContent = new Date().getFullYear();

    // Reveal (hero shown immediately)
    (function(){
      const all = document.querySelectorAll('.reveal');
      if (!('IntersectionObserver' in window)) { all.forEach(el=>el.classList.add('show')); return; }
      document.querySelectorAll('.page-hero .reveal').forEach(el=>el.classList.add('show'));
      const io = new IntersectionObserver((entries)=>{
        entries.forEach(e=>{ if(e.isIntersecting){ e.target.classList.add('show'); io.unobserve(e.target); } });
      }, {threshold:0, rootMargin:'-10% 0px -10% 0px'});
      all.forEach(el=>io.observe(el));
      window.addEventListener('load', ()=>setTimeout(()=>document.querySelectorAll('.reveal:not(.show)').forEach(el=>el.classList.add('show')), 250));
    })();

    // Nav indicator
    (function(){
      const menu = document.getElementById('mainMenu');
      if(!menu) return;
      const links = Array.from(menu.querySelectorAll('a[href]'));
      const bar = menu.querySelector('.indicator');
      const file = (location.pathname.split('/').pop() || 'index.html').split('?')[0];
      const here = links.find(a => (a.getAttribute('href')||'').split('?')[0] === file) || links[0];

      function moveBar(el){
        const pad = 10;
        bar.style.width = (el.offsetWidth - pad*2) + 'px';
        bar.style.left  = (el.offsetLeft + pad) + 'px';
        bar.style.opacity = 1;
      }
      function setActive(el){
        links.forEach(a=>a.classList.remove('is-active'));
        el.classList.add('is-active');
        moveBar(el);
      }
      setActive(here);
      links.forEach(a=>{
        a.addEventListener('mouseenter', ()=>moveBar(a));
        a.addEventListener('mouseleave', ()=>moveBar(menu.querySelector('.is-active') || here));
        a.addEventListener('click', ()=>{ setActive(a); sessionStorage.setItem('iotguard_nav_active', a.getAttribute('href')); });
      });
      const saved = sessionStorage.getItem('iotguard_nav_active');
      const savedLink = links.find(a=>a.getAttribute('href')===saved);
      if(savedLink) setActive(savedLink);
      window.addEventListener('resize', ()=> moveBar(menu.querySelector('.is-active') || here));
    })();

    // ----- Backlog logic -----
    const KEY='iotguard_backlog_prebuild_v1';
    const seed=[
      {id:'IG-001', title:'Create repo & project skeleton', prio:'High', status:'todo', owner:'Ahmad', points:2},
      {id:'IG-002', title:'Define MVP scope & dataset choice', prio:'High', status:'todo', owner:'Ates', points:2},
      {id:'IG-003', title:'Select stack (Python ML, FastAPI, React UI)', prio:'High', status:'todo', owner:'Esra', points:2},
      {id:'IG-004', title:'Collect & preprocess dataset (IoT traffic)', prio:'High', status:'todo', owner:'Team', points:5},
      {id:'IG-005', title:'Feature extraction pipeline (pcap â†’ features)', prio:'High', status:'todo', owner:'Ahmad', points:5},
      {id:'IG-006', title:'Baseline anomaly detection model', prio:'High', status:'todo', owner:'Esra', points:5},
      {id:'IG-007', title:'Edge agent stub (capture & forward)', prio:'Medium', status:'todo', owner:'Ates', points:5},
      {id:'IG-008', title:'Dashboard stub (alerts list)', prio:'Medium', status:'todo', owner:'Ahmad', points:3},
      {id:'IG-009', title:'Evaluation plan (metrics & test cases)', prio:'Medium', status:'todo', owner:'Esra', points:2},
      {id:'IG-010', title:'Risk & ethics checklist (GDPR, NIST refs)', prio:'Low', status:'todo', owner:'Team', points:1},
    ];
    function load(){
      const raw=localStorage.getItem(KEY);
      if(!raw){save(seed);return seed;}
      try{return JSON.parse(raw);}catch(e){return seed;}
    }
    function save(items){localStorage.setItem(KEY,JSON.stringify(items));}

    let items=load();
    const drops={todo:document.getElementById('todo'),doing:document.getElementById('doing'),done:document.getElementById('done')};
    const counts={todo:document.getElementById('cTodo'),doing:document.getElementById('cDoing'),done:document.getElementById('cDone')};
    const tbody=document.getElementById('tbody');
    const search=document.getElementById('search');

    function pill(p){const c=p==='High'?'p-high':p==='Medium'?'p-med':'p-low';return `<span class="pill ${c}">${p}</span>`;}
    function card(it){return `<div class="cardx" draggable="true" data-id="${it.id}">
      <div class="title">${it.title}</div>
      <div class="meta">${pill(it.prio)} ðŸ‘¤ ${it.owner} â€¢ ${it.id} â€¢ â˜… ${it.points}</div></div>`;}

    function render(){
      ['todo','doing','done'].forEach(c=>{drops[c].innerHTML='';});
      items.forEach(it=>drops[it.status].insertAdjacentHTML('beforeend',card(it)));
      ['todo','doing','done'].forEach(c=>counts[c].textContent=items.filter(i=>i.status===c).length);
      renderTable(); bindDnD();
    }
    function renderTable(){
      const q=search.value.toLowerCase();
      tbody.innerHTML=items.filter(it=>(it.title+it.owner+it.prio+it.id).toLowerCase().includes(q))
        .map(it=>`<tr><td>${it.id}</td><td>${it.title}</td><td>${it.prio}</td><td>${it.status}</td><td>${it.owner}</td><td>${it.points}</td></tr>`).join('');
    }
    function bindDnD(){
      document.querySelectorAll('.cardx').forEach(c=>{
        c.addEventListener('dragstart',e=>{e.dataTransfer.setData('id',c.dataset.id);setTimeout(()=>c.style.opacity=.4)});
        c.addEventListener('dragend',()=>c.style.opacity=1);
      });
      document.querySelectorAll('.drop').forEach(z=>{
        z.addEventListener('dragover',e=>{e.preventDefault();z.classList.add('dragover')});
        z.addEventListener('dragleave',()=>z.classList.remove('dragover'));
        z.addEventListener('drop',e=>{e.preventDefault();z.classList.remove('dragover');
          const id=e.dataTransfer.getData('id');
          items=items.map(it=>it.id===id?{...it,status:z.dataset.col}:it);
          save(items);render();
        });
      });
    }
    document.getElementById('newItem').addEventListener('submit',e=>{
      e.preventDefault();
      const t=document.getElementById('title').value.trim();
      if(!t) return;
      const a=document.getElementById('assignee').value;
      const p=document.getElementById('priority').value;
      const sp=parseInt(document.getElementById('points').value||'0',10);
      const next = Math.max(10, ...items.map(i=>parseInt(i.id.split('-')[1]||'10',10))) + 1;
      const id=`IG-${String(next).padStart(3,'0')}`;
      items.push({id,title:t,prio:p,status:'todo',owner:a,points:sp});
      save(items);render();e.target.reset();
    });
    search.addEventListener('input',renderTable);
    document.getElementById('exportCsv').addEventListener('click',()=>{
      const rows=[['ID','Title','Priority','Status','Assignee','Points'],...items.map(i=>[i.id,i.title,i.prio,i.status,i.owner,i.points])];
      const csv=rows.map(r=>r.map(v=>`"${String(v).replace(/"/g,'""')}"`).join(',')).join('\n');
      const a=document.createElement('a');a.href=URL.createObjectURL(new Blob([csv]));a.download='IoTGuard-Backlog.csv';a.click();
    });
    document.getElementById('resetBoard').addEventListener('click',()=>{
      if(confirm('Reset backlog?')){ localStorage.removeItem(KEY); items=seed; save(items); render(); }
    });
    render();
  </script>
</body>
</html>
